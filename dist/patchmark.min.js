/*! patchmark - v1.0.0 - 2014-12-15
* https://github.com/hidcliff/patchmark.js
* Copyright (c) 2014 ; Licensed  */
!function(){"use strict";var a={},b={},c=[],d=!1,e={spans:{strong:{pattern:/(?:^|([^\\]))([*_])\2([\s\S]+?)\2\2/g,func:function(a,b,c,d){var e=[];return b&&b.search(/\\/)<0&&e.push(b),e.push("<strong>"+d+"</strong>"),e.join("")}},emphasize:{pattern:/(?:^|([^\\]))([*_])([\s\S]+?)\2/g,func:function(a,b,c,d){var e=[];return b&&b.search(/\\/)<0&&e.push(b),e.push("<em>"+d+"</em>"),e.join("")}},code:{pattern:/(`+)([\s\S]+?)\1(?!`)/g,func:function(a,b,c){return"<code>"+f.escapeHTML(f.strip(c))+"</code>"}},link:{pattern:/(!?)\[((?:\[[^\[\]]*\]|[^\[\]])+)\]\([ \t]*([^\)]+?)[ \t]*(?:(['"])([\s\S]+?)\4[ /t]*)?\)/g,func:function(a,b,c,d,e,g){return c=f.parseSpanRules(c),b?'<img src="'+d+'" alt="'+c+'"'+(g?' title="'+g+'"':"")+" />":'<a href="'+d+'"'+(g?' title="'+g+'"':"")+">"+c+"</a>"}},referenceLink:{pattern:/(!?)\[([^\[\]]+)\](?:[ \t]*\[([^\[\]]*)\])?/g,func:function(a,c,d,e){var f=b[(e||d).toLowerCase()];return f?c.search(/!/)>-1?'<img src="'+f.link+'" alt="'+d+'"'+(f.title?' title="'+f.title+'"':"")+" />":'<a href="'+f.link+'"'+(f.title?' title="'+f.title+'"':"")+">"+d+"</a>":a}},automaticLink:{pattern:/<((https?|ftp):[^>]+)>/g,func:function(a,b){return'<a href="'+b+'">'+b+"</a>"}},email:{pattern:/<((mailto:)?(.+?\@[-.a-zA-Z0-9]+?\.[a-zA-Z]+))>/g,func:function(a,b,c,d){return'<a href="'+f.toHexString("mailto:"+d)+'">'+f.toHexString(d)+"</a>"}},backslash:{pattern:/\\([\\`*_{}\[\]()#+-.!])/g,func:function(a,b){return b}}},blocks:{atxHeader:{pattern:/^[ ]{0,3}(.+)[ \t]*\n([=-])\2\2+[ \t]*$/gm,func:function(a,b,c){return"="===c?"<h1>"+b+"</h1>\n":"<h2>"+b+"</h2>\n"}},setextHeader:{pattern:/^[ ]{0,3}(#{1,6})[ \t]*(.+?)[ \t]*#*$/gm,func:function(a,b,c){var d=b.length;return"<h"+d+">"+c+"</h"+d+">\n"}},code:{pattern:/(\n\n)^(([ ]{4}|\t).*\n*)+(?=\S|$)/gm,func:function(a,b){var c=a;return c=f.detachTab(c),c=f.escapeTab(c),c=f.escapeHTML(c),c=f.strip(c),b+f.encodeBlock("<pre><code>"+c+"\n</code></pre>")+"\n"}},fencedCode:{pattern:/^[ ]*(`{3,})[ ]*(.+)?[ ]*\n([\s\S]+?)\1(?=\n|$)/gm,func:function(a,b,c,d){var e=d;return e=f.escapeTab(e),e=f.escapeHTML(e),e=f.strip(e),f.encodeBlock("<pre><code>"+e+"\n</code></pre>")+"\n"}},blockquote:{pattern:/(^[ ]{0,3}>([ ]{0,4}|\t).+\n(.+\n)*\n*)+/gm,func:function(a){var b=a;return b=f.detachQuote(b),b=f.parse(b),b=f.rstrip(b),f.encodeBlock("<blockquote>\n"+b+"\n</blockquote>")+"\n\n"}},paragraph:{pattern:/\n{2,}/g,func:function(a){var b=a;return b.search(/\S/)<0?"":b.search(/^\|\|PMB\d+PMB\|\|/)>-1?b:b.search(/^[ ]{0,3}<(h\d|div|blockquote|pre|ul|ol)>[\s\S]+?(<\/\1>)?/)>-1?b:b.search(/^[ ]{0,3}<hr \/>/)>-1?b:(b=f.replace("lineBreak",b),b=f.strip(b),"<p>"+b+"</p>")}},list:{pattern:/(?:\n\n)((^[ ]*)([*+-]|\d+\.)[ \t][\s\S]+?\n{2,}(?!(([*+-]|\d+\.)[ \t]|([ ]{4}|\t)).))/gm,func:function(a,b,c,e){var g=b,h=e.search(/[*+-]/g)>-1?"ul":"ol";return d=!1,g=f.replace("listItem",g+"\n\n\n"),g=f.rstrip(g),"<"+h+">\n"+g+"\n</"+h+">\n\n"}},subList:{pattern:/((^[ ]*)([*+-]|\d+\.)[ \t][\s\S]+?\n{2,}(?!(([*+-]|\d+\.)[ \t]|([ ]{4}|\t)).))/gm,func:function(a,b){var c=a,d=b.search(/[*+-]/g)>-1?"ul":"ol";return c=f.replace("listItem",c),c=f.rstrip(c),"<"+d+">\n"+c+"\n</"+d+">\n"}},listItem:{pattern:/^[ ]*([*+-]|\d+\.)[ \t]([\s\S]+?\n{1,2})(?=\n*(?:[ ]{0,3}([*+-]|\d+\.)[ \t])|(?:\n\n\s*$))/gm,func:function(a,b,c,e){var g=c,h=g.search(/\n{2,}./)>-1||e&&g.search(/\n{2,}$/)>-1;return g=f.detachFirstSpaces(g),g=f.replace("subList",g+"\n\n"),g=f.rstrip(g),g=f.parseListItem(g),g=h||d?f.paragraph(g):f.parseSpanRules(g),d=h,"<li>"+g+"</li>\n"}},horizon:{pattern:/^[ ]{0,3}(\*|-)[ ]*\1[ ]*\1.*$/gm,func:"<hr />\n"},lineBreak:{pattern:/([ ]{2,}|\t)\n/g,func:"<br />\n"},references:{pattern:/^[ ]{0,3}\[([^\[\]]+)\]:[ \t]*([\S]+)(?:[ \t]*(?:\"([^\"]+)\"|'([^\']+)'|\(([^\)]+)\)))?/gm,func:function(a,c,d,e,f,g){return b[c.toLowerCase()]={link:d,title:e||f||g},""}}}},f={_getRule:function(a,b){return e[b?"spans":"blocks"][a]},_replace:function(a,b){if(!b)return a;if(b instanceof Array){for(var c=0;c<b.length;c++)a=this._replace(a,b[c]);return a}return a.replace(b.pattern,b.func)},escapeHTML:function(a){return a=this._replace(a,{pattern:/&/g,func:"&amp;"}),a=this._replace(a,{pattern:/</g,func:"&lt;"}),a=this._replace(a,{pattern:/>/g,func:"&gt;"}),a=this._replace(a,{pattern:/"/g,func:"&quot;"}),this._replace(a,{pattern:/'/g,func:"&#39;"})},escapeTab:function(a){return this._replace(a,{pattern:/\t/g,func:"    "})},detachFirstSpaces:function(a){return this._replace(a,{pattern:/^([ ]{1,4}|\t)/gm,func:""})},detachTab:function(a){return this._replace(a,{pattern:/^([ ]{4}|\t)/gm,func:""})},detachQuote:function(a){return this._replace(a,{pattern:/^[ ]{0,3}>[ \t]?/gm,func:""})},toHexString:function(a){for(var b=[],c=0,d=a.length;d>c;c++)b.push("&#x"+a.charCodeAt(c).toString(16)+";");return b.join("")},strip:function(a){return this.rstrip(this.lstrip(a))},lstrip:function(a){return this._replace(a,{pattern:/^\s+/g,func:""})},rstrip:function(a){return this._replace(a,{pattern:/\s+$/g,func:""})},encodeBlock:function(a){return"||PMB"+(c.push(a)-1)+"PMB||"},decodeBlocks:function(a){return this.strip(this._replace(a,{pattern:/(\|\|)PMB(\d+)PMB\1/g,func:function(a,b,d){return c[d]}}))},replace:function(a,b){return this._replace(b,this._getRule(a))},standardizeNewline:function(a){return a=this._replace(a,{pattern:/\r\n/g,func:"\n"}),a=this._replace(a,{pattern:/\r/g,func:"\n"})},parseSpanRules:function(a){var b=e.spans;for(var c in b)a=this._replace(a,b[c]);return a},paragraph:function(a){var b=this._getRule("paragraph"),c=a.split(b.pattern),d=[];for(var e in c)d.push(b.func(this.parseSpanRules(this.strip(c[e]))));return d.join("\n")},_addTemporaryNewline:function(a){return"\n\n"+a+"\n\n"},_removeTemporaryNewline:function(a){return this._replace(a,[{pattern:/^\n\n/,func:""},{pattern:/([\s\S]+)\n\n$(?![\s\S])/,func:"$1"}])},parseListItem:function(a){var b=this._addTemporaryNewline(a);return b=this.replace("blockquote",b),b=this.replace("atxHeader",b),b=this.replace("setextHeader",b),b=this.replace("horizon",b),b=this.replace("fencedCode",b),b=this.replace("code",b),b=this.decodeBlocks(b),b=this._removeTemporaryNewline(b)},parse:function(a){var b=this._addTemporaryNewline(a);return b=this.standardizeNewline(b),b=this.replace("references",b),b=this.replace("blockquote",b),b=this.replace("atxHeader",b),b=this.replace("setextHeader",b),b=this.replace("horizon",b),b=this.replace("list",b),b=this.replace("fencedCode",b),b=this.replace("code",b),b=this.paragraph(b),b=this.decodeBlocks(b),b=this._removeTemporaryNewline(b),c=[],b}};a.parse=function(a){return f.parse(a)},"undefined"!=typeof module&&"object"==typeof exports?module.exports=a:window.patchmark=a}();